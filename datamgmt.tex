\documentclass[aspectratio=169,12pt,t]{beamer}
\usepackage{graphicx}
\setbeameroption{hide notes}
\setbeamertemplate{note page}[plain]
\usepackage{listings}

\input{header.tex}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% end of header
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

% title info
\title{Data Management}
\author{\href{https://kbroman.org}{Karl Broman}}
\institute{Biostatistics \& Medical Informatics \\ Univ.\ Wisconsin{\textendash}Madison}
\date{\href{https://kbroman.org}{\tt \scriptsize \color{foreground} kbroman.org}
\\[2pt]
\scriptsize {\lolit Slides:} \href{https://bit.ly/datamgmt2019}{\tt \scriptsize
  \color{foreground} bit.ly/datamgmt2019}
}


\begin{document}

% title slide
{
\setbeamertemplate{footline}{} % no page number here
\frame{
  \titlepage

  \vfill \hfill \includegraphics[height=6mm]{Figs/cc-zero.png} \vspace*{-1cm}

} }


\begin{frame}[c]{Outline}

  \bbi
\item Organizing and naming files
\item Organizing data within spreadsheets
\item Cleaning data
  \ei

\end{frame}



\begin{frame}[fragile,c]{}

\begin{center}
\begin{minipage}[c]{9.3cm}
\begin{semiverbatim}
\lstset{basicstyle=\normalsize}
\begin{lstlisting}[linewidth=9.3cm]
 Karl -- this is very interesting,
 however you used an old version of
 the data (n=143 rather than n=226).

 I'm really sorry you did all that
 work on the incomplete dataset.

 Bruce
\end{lstlisting}
\end{semiverbatim}
\end{minipage}
\end{center}

\end{frame}


\begin{frame}[c]{}
\centering
{\Large The results in Table 1 don't seem to \\[12pt]
correspond to those in Figure 2.}

\end{frame}



\begin{frame}[c]{}
\centerline{\Large Where did we get this data file?}
\end{frame}



\begin{frame}[c]{}
\centerline{\Large Why did I omit those samples?}
\end{frame}



\begin{frame}[c]{}
\centerline{\Large Which image goes with which experiment?}
\end{frame}



\begin{frame}[c]{}
\centerline{\Large How did I make that figure?}
\end{frame}


\begin{frame}[c]{}
\centerline{\Large In what order do I run these scripts?}
\end{frame}



\begin{frame}[c]{}
\centerline{\Large ``Your script is now giving an error."}
\end{frame}



\begin{frame}[c]{}
\centerline{\Large ``The attached is similar to the code we used."}
\end{frame}




\begin{frame}[c]{1. Organizing projects}

\begin{center}
\large
File organization and naming \\
are powerful weapons against chaos.
\end{center}

\hfill
{\lolit
{\textendash} \href{http://www.stat.ubc.ca/~jenny/}{Jenny Bryan}
}

\end{frame}


\begin{frame}[c]{1. Organizing projects}

\begin{center}
\large
Your closest collaborator is you six months ago, \\
but you don't reply to emails.
\end{center}

\hfill
{\lolit
(paraphrasing \href{https://twitter.com/kcranstn/status/370914072511791104}{Mark Holder})
}

\end{frame}


\begin{frame}[c]{1. Organizing projects}

\begin{center}
\large
Have sympathy for your future self.
\end{center}


\end{frame}




\begin{frame}[c]{How to organize these files?}

\vspace{5mm}

\figw{Figs/activity2b.png}{1.08}

\end{frame}




\begin{frame}<handout:0>[fragile,c]{Be consistent}

\only<1>{\addtocounter{framenumber}{-1}}

\begin{center}
\begin{minipage}[c]{10.3cm}
\begin{semiverbatim}
\lstset{basicstyle=\normalsize}
\begin{lstlisting}[linewidth=10.3cm]
RawData/              Notes/
CleanData/            Refs/

Python/               ReadMe.txt
R/                    ToDo.txt
Ruby/
\end{lstlisting}
\end{semiverbatim}
\end{minipage}
\end{center}

\end{frame}


\begin{frame}<handout:0>[fragile,c]{Chaos}

\addtocounter{framenumber}{-1}

\begin{center}
\begin{minipage}[c]{11.33cm}
\begin{semiverbatim}
\lstset{basicstyle=\scriptsize}
\begin{lstlisting}[linewidth=11.33cm]
AimeeNullSims/    Deuterium/            Ping/
AimeeResults/     ExtractData4Gary/     Ping2/
AnnotationFiles/  FromAimee/            Ping3/
Brian/            GoldStandard/         Ping4/
Chr6_extrageno/   HumanGWAS/            Play/
Chr6_segdis/      Insulin/              Prdm9/
ChrisPlaisier/    Int2_for_Mark/        RBM_PlasmaUrine_2012-03-08/
Code4Aimee/       Islet_2011-05/        Slco1a6/
CompAnnot/        MappingProbes/        StudyLineupMethods/
CondScans/        MultiProbes/          kidney_chr6.R
D2O_2012-02-14/   NewMap/               pck2_sucla2.R
D2O_cellcycle/    Notes/                penalties.txt
D2Ocorr/          NullSims/             transeQTL4Lude/
Data4Aimee/       NullSims_2009-09-10/
Data4Tram/        PepIns_2012-02-09/
\end{lstlisting}
\end{semiverbatim}
\end{minipage}
\end{center}

\end{frame}



\begin{frame}[fragile,c]{Choose good names for things}

\begin{center}
\begin{minipage}[c]{13.7cm}
\begin{semiverbatim}
\lstset{basicstyle=\scriptsize}
\begin{lstlisting}[linewidth=13.7cm]
betw_tissue_corr.R     expr_scatterplot_allprobes.R  gve_similarity_alltissues.R
coatcolor_lod.R        expr_scatterplots_dup.R       gve_similarity.R
colors.R               expr_scatterplots_mix.R       gve_supp.R
cover_fig.R            expr_scatterplots_swap.R      insulin_lod.R
eqtl_counts_10.R       expr_swaps.R                  local_eqtl_locations.R
eqtl_counts.R          func.R                        my_plot_map.R
eve_hist.R             genotype_plates.R             my_plot_scanone.R
eve_scheme.R           gve_hist.R                    sex_vs_X.R
eve_similarity.R       gve_new.R                     xchr_fig.R
eve_similarity_supp.R  gve.R                         xist_and_y.R
expr_corr_dup.R        gve_scheme.R
expr_corr_mix.R        gve_similarity_2ndbest.R
\end{lstlisting}
\end{semiverbatim}
\end{minipage}
\end{center}

\end{frame}


\begin{frame}[fragile,c]{Choose good names for things}

\begin{center}
\begin{minipage}[c]{8.3cm}
\begin{semiverbatim}
\lstset{basicstyle=\normalsize}
\begin{lstlisting}[linewidth=8.3cm]
fig1.png        fig5.png
fig10.png       fig6.png
fig2.png        fig7.png
fig3.png        fig8.png
fig4.png        fig9.png
\end{lstlisting}
\end{semiverbatim}
\end{minipage}
\end{center}

\end{frame}






\begin{frame}[c]{Choose good names for things}

  \bbi
  \item Machine readable
    \bi
    \item No spaces
    \item No special characters except {\textunderscore} and
      {\tt -}
    \ei

  \item Human readable
    \bi
    \item Explain the contents
    \ei

  \item Consistent
    \bi
      \item Name similar files in a similar way
    \ei

  \item Make use of computer's sorting
    \bi
      \item pad numbers with 0's (e.g., {\tt 01}, {\tt 02}, ...)
      \item start with general grouping, then more specific
      \item dates like {\tt 2019-05-14}
    \ei

  \ei
\end{frame}



\begin{frame}[fragile,c]{Choose good names for things}

\begin{center}
\begin{minipage}[c]{10.3cm}
\begin{semiverbatim}
\lstset{basicstyle=\normalsize}
\begin{lstlisting}[linewidth=10.3cm]
0_vcf2db.R
1_prep_geno.R
2_prep_pheno_clin.R
2_prep_pheno_otu.R
3_prep_covar.R
4_prep_analysis_pheno_clin.R
4_prep_analysis_pheno_otu.R
5_scans.R
6_grab_peaks.R
7_find_nearby_peaks.R
\end{lstlisting}
\end{semiverbatim}
\end{minipage}
\end{center}

\end{frame}




\begin{frame}[c]{No ``{\hilit final}'' in file names}

\vspace*{3mm}

\centering

% comic from http://www.phdcomics.com/comics/archive.php?comicid=1531
\figh{Figs/phd101212s.png}{0.8}

\end{frame}



\begin{frame}<handout:0>[fragile,c]{No ``{\hilit final}'' in file names}


\addtocounter{framenumber}{-1}


\begin{center}
\begin{minipage}[c]{9.5cm}
\begin{semiverbatim}
\lstset{basicstyle=\tiny}
\begin{lstlisting}[escapechar=!,linewidth=9.5cm]
!{\color{foreground}{Deprecated/                            hypo_prcomp.RData}!
!{\color{foreground}{ReadMe.txt                             islet_int1_final.RData}!
!{\color{foreground}{adipose_int1_final.RData               islet_int2_final.RData}!
!{\color{foreground}{adipose_int2_final.RData               islet_mlratio_final.RData}!
!{\color{foreground}{adipose_mlratio_final.RData            islet_mlratio_nqrank_final.RData}!
!{\color{foreground}{adipose_mlratio_nqrank_final.RData     islet_prcomp.RData}!
!{\color{foreground}{adipose_prcomp.RData                   kidney_int1_final.RData}!
!{\color{foreground}{aligned_geno_with_pmap.RData           kidney_int2_final.RData}!
!{\color{foreground}{batches_final.RData                    kidney_mlratio_final.RData}!
!{\color{foreground}{batches_raw_final.RData                kidney_mlratio_nqrank_final.RData}!
!{\color{foreground}{cpl_final.RData                        kidney_prcomp.RData}!
!{\color{foreground}{d2o_final.RData                        lipomics_final_rev2.RData}!
!{\color{foreground}{gastroc_int1_final.RData               liverTG_final.RData}!
!{\color{foreground}{gastroc_int2_final.RData               liver_int1_final.RData}!
!{\color{foreground}{gastroc_mlratio_final.RData            liver_int2_final.RData}!
!{\color{foreground}{gastroc_mlratio_nqrank_final.RData     liver_mlratio_final.RData}!
!{\color{foreground}{gastroc_prcomp.RData                   liver_mlratio_nqrank_final.RData}!
!{\color{foreground}{hypo_int1_final.RData                  liver_prcomp.RData}!
!{\color{foreground}{hypo_int2_final.RData                  mirna_final.RData}!
!{\color{foreground}{hypo_mlratio_final.RData               necropsy_final_rev2.RData}!
!{\color{foreground}{hypo_mlratio_final_old.RData           plasmaurine_final_rev.RData}!
!{\color{foreground}{hypo_mlratio_nqrank_final.RData        pmark.RData}!
!{\color{foreground}{hypo_mlratio_nqrank_final_old.RData    rbm_final.RData}!
!{\color{foreground}{hypo_omit.RData}!
\end{lstlisting}
\end{semiverbatim}
\end{minipage}
\end{center}



\end{frame}


\begin{frame}[fragile,c]{No ``{\hilit final}'' in file names}


\begin{center}
\begin{minipage}[c]{9.5cm}
\begin{semiverbatim}
\lstset{basicstyle=\tiny}
\begin{lstlisting}[escapechar=!,linewidth=9.5cm]
!{\color{foreground}{Deprecated/                            hypo_prcomp.RData}!
!{\color{foreground}{ReadMe.txt                             islet_int1_final.RData}!
!{\color{foreground}{adipose_int1_final.RData               islet_int2_final.RData}!
!{\color{foreground}{adipose_int2_final.RData               islet_mlratio_final.RData}!
!{\color{foreground}{adipose_mlratio_final.RData            islet_mlratio_nqrank_final.RData}!
!{\color{foreground}{adipose_mlratio_nqrank_final.RData     islet_prcomp.RData}!
!{\color{foreground}{adipose_prcomp.RData                   kidney_int1_final.RData}!
!{\color{foreground}{aligned_geno_with_pmap.RData           kidney_int2_final.RData}!
!{\color{foreground}{batches_final.RData                    kidney_mlratio_final.RData}!
!{\color{foreground}{batches_raw_final.RData                kidney_mlratio_nqrank_final.RData}!
!{\color{foreground}{cpl_final.RData                        kidney_prcomp.RData}!
!{\color{foreground}{d2o_final.RData                       }!!{\color{vhilit} lipomics_final_rev2.RData}!
!{\color{foreground}{gastroc_int1_final.RData               liverTG_final.RData}!
!{\color{foreground}{gastroc_int2_final.RData               liver_int1_final.RData}!
!{\color{foreground}{gastroc_mlratio_final.RData            liver_int2_final.RData}!
!{\color{foreground}{gastroc_mlratio_nqrank_final.RData     liver_mlratio_final.RData}!
!{\color{foreground}{gastroc_prcomp.RData                   liver_mlratio_nqrank_final.RData}!
!{\color{foreground}{hypo_int1_final.RData                  liver_prcomp.RData}!
!{\color{foreground}{hypo_int2_final.RData                  mirna_final.RData}!
!{\color{foreground}{hypo_mlratio_final.RData              }!!{\color{vhilit} necropsy_final_rev2.RData}!
!{\color{vhilit}{hypo_mlratio_final_old.RData           plasmaurine_final_rev.RData}!
!{\color{foreground}{hypo_mlratio_nqrank_final.RData        pmark.RData}!
!{\color{vhilit}{hypo_mlratio_nqrank_final_old.RData   }!!{\color{foreground} rbm_final.RData}!
!{\color{foreground}{hypo_omit.RData}!
\end{lstlisting}
\end{semiverbatim}
\end{minipage}
\end{center}


\end{frame}


\begin{frame}[fragile,c]{Choose good names for things}


\begin{center}
\begin{minipage}[c]{9.5cm}
\begin{semiverbatim}
\lstset{basicstyle=\tiny}
\begin{lstlisting}[escapechar=!,linewidth=9.5cm]
batches_raw_v1.rds               geneexpr_mlratio_gastroc_v2.rds
batches_v1.rds                   geneexpr_mlratio_hypo_v1.rds
clinical_cpl_v2.rds              geneexpr_mlratio_hypo_v2.rds
clinical_d2o_v2.rds              geneexpr_mlratio_islet_v2.rds
clinical_lipomics_v4.rds         geneexpr_mlratio_kidney_v2.rds
clinical_liverTG_v2.rds          geneexpr_mlratio_liver_v2.rds
clinical_mirna_v2.rds            geneexpr_mlratio_nqrank_adipose_v2.rds
clinical_necropsy_v4.rds         geneexpr_mlratio_nqrank_gastroc_v2.rds
clinical_plasmaurine_v3.rds      geneexpr_mlratio_nqrank_hypo_v1.rds
clinical_rbm_v2.rds              geneexpr_mlratio_nqrank_hypo_v2.rds
Deprecated/                      geneexpr_mlratio_nqrank_islet_v2.rds
geneexpr_int1_adipose_v2.rds     geneexpr_mlratio_nqrank_kidney_v2.rds
geneexpr_int1_gastroc_v2.rds     geneexpr_mlratio_nqrank_liver_v2.rds
geneexpr_int1_hypo_v2.rds        geneexpr_omit_hypo.rds
geneexpr_int1_islet_v2.rds       geneexpr_prcomp_adipose_v2.rds
geneexpr_int1_kidney_v2.rds      geneexpr_prcomp_gastroc_v2.rds
geneexpr_int1_liver_v2.rds       geneexpr_prcomp_hypo_v2.rds
geneexpr_int2_adipose_v2.rds     geneexpr_prcomp_islet_v2.rds
geneexpr_int2_gastroc_v2.rds     geneexpr_prcomp_kidney_v2.rds
geneexpr_int2_hypo_v2.rds        geneexpr_prcomp_liver_v2.rds
geneexpr_int2_islet_v2.rds       geno_aligned_w_pmap.rds
geneexpr_int2_kidney_v2.rds      geno_pmark.rds
geneexpr_int2_liver_v2.rds       ReadMe.txt
geneexpr_mlratio_adipose_v2.rds
\end{lstlisting}
\end{semiverbatim}
\end{minipage}
\end{center}

\end{frame}



\begin{frame}[c]{Document your work}

  \bbi
\item What is all of this stuff?
\item What was your analysis process?
\vspace{1cm}
\item[$\boldsymbol{\rightarrow}$] {\large {\tt ReadMe} files}
  \ei

\end{frame}




\begin{frame}[c]{2. Organizing data in spreadsheets}

\begin{center}
\large
Organize data for computers
\end{center}

\end{frame}


\begin{frame}[c]{Improve this arrangement?}

\figw{Figs/spreadsheet_ugly.pdf}{1.0}

\end{frame}




\begin{frame}[c]{Improved arrangement}

\figw{Figs/spreadsheet_tidy.pdf}{1.0}

\end{frame}



\begin{frame}[c]{Organizing data in spreadsheets}

  \begin{itemize}
    \footnotesize
  \item Make it a rectangle (rows = observations, cols=variables)
  \item Use a single header row; avoid spaces.
  \item Be consistent.
  \item Use care about dates.
  \item Put just one thing in a cell.
  \item Fill in all cells.
  \item Explicit code for missing values (e.g. {\tt -} or {\tt N/A})
  \item No calculations/graphs in the raw data files.
  \item Don't use font color or highlighting as data.
  \item Make backups.
  \item Use data validation to avoid data entry mistakes.
  \item Save the data in plain text files.
  \end{itemize}


\vspace{7mm}

\hfill
{\footnotesize \lolit
\href{https://doi.org/10.1080/00031305.2017.1375989}{Broman \& Woo,
Am Stat 78:2--10, 2018}
}




\end{frame}




\begin{frame}[c]{}

\begin{center}
  \Large


``What the heck is `{\hilit \tt FAD{\textunderscore}NAD SI 8.3{\textunderscore}3.3G}'?''

\end{center}

\end{frame}




\begin{frame}[c]{Metadata}

  \bbi
\item Create a data dictionary
  \bi
\item Explain each column
\item Include different versions of the variable names (compact vs descriptive)
\item Units
\item Allowable values
  \ei
\item The metadata are data
  \bi
\item Make it a rectangle
  \ei
\ei

\end{frame}




\begin{frame}[c]{Data dictionary}


\figw{Figs/data_dict.pdf}{1.0}


\end{frame}





\begin{frame}[c]{3. Data cleaning}

  \bbi
\item What might have gone wrong?
\item How could it be revealed?
\item Make lots of plots
  \bi
\item scatterplots
\item plots against time
\item consider taking logs
  \ei
\item Check consistency between files
\item Outliers
  \bi
\item Real or error?
\item Are the results affected?
  \ei
  \ei

\end{frame}


\begin{frame}[c]{Batch effect}


\only<1>{\figh{Figs/il3.pdf}{0.85}}
\only<2>{\figh{Figs/il3_log.pdf}{0.85}}


\end{frame}



\begin{frame}[c]{Messed up units}

\figh{Figs/adipose_weight.pdf}{0.85}


\end{frame}



\begin{frame}[c]{Outliers}

\figh{Figs/body_weight.pdf}{0.85}

\end{frame}




\begin{frame}[c]{}

\begin{center}
\large
The most important tool is the {\hilit mindset},\\
when starting, that the end product \\
will be reproducible.
\end{center}

\hfill
{\lolit
{\textendash} \href{http://odin.mdacc.tmc.edu/~kabaggerly/}{Keith Baggerly}
}

\end{frame}



\begin{frame}[c]{Resources}

  \bbi
\item These slides: \href{https://bit.ly/datamgmt2019}{\tt bit.ly/datamgmt2019} \quad
\includegraphics[height=5mm]{Figs/cc-zero.png}
\item \href{https://www.amazon.com/gp/product/B019NDNOMA?ie=UTF8&tag=7210-20}{Briney (2015) Data management for researchers}
\item Research Data Services,
  \href{http://researchdata.wisc.edu/}{\tt researchdata.wisc.edu}
\item Data Science Hub,
  \href{https://datascience.wisc.edu/}{\tt datascience.wisc.edu}
\item Data Carpentry workshops,
  \href{https://datacarpentry.org/}{\tt datacarpentry.org}
  \ei

\end{frame}




\end{document}
